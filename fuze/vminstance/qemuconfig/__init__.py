#!/usr/bin/python
import json
class qemuConfig(object):
    def __init__(self, qemu_config_file = None):
        try:
            cfg_file = open(qemu_config_file,'r')
            config = json.load(cfg_file)
            self.ssh_keyfile = config['ssh_keyfile']
            self.qemu_path = config['qemu_path']
            self.kernel_path = config['kernel_path']
            self.append = config['append']
            self.ssh_port = config['ssh_port']
            self.ram_size = config['ram_size']
            self.monitor_port = config['monitor_port']
            self.hda = config['hda']
            self.gdb_port = config['gdb_port']
            self.vmlinux_path = config['vmlinux_path']
        except KeyError as e:
            print 'key', e
            print('[!] failed to load qemu_config_file')
        return
         


def test():
    data = {'qemu_path' : '/home/ww9210/tools/qemu-2.10.1/build/x86_64-softmmu/qemu-system-x86_64'\
            , 'kernel_path' : '/home/ww9210/kernels/4.14-rc1-no-kasan/arch/x86/boot/bzImage'\
            , 'append':'console=ttyS0 root=/dev/sda debug earlyprintk=serial oops=panic'\
            , 'hda':'/home/ww9210/develop/kuafffp/test/15649_test/img/wheezy.img'\
            , 'ssh_port':10021\
            , 'ram_size':'1G'\
            , 'monitor_port':9210\
            , 'gdb_port':1234\
            , 'ssh_keyfile':'/home/ww9210/develop/kuafffp/test/15649_test/img/ssh/id_rsa'\
            , 'vmlinux_file':'/home/ww9210/kernels/4.14-rc1-no-kasan/vmlinux'\
            }
    with open('cve-2017-15649-nokasan.cfg', 'w') as outfile:
        json.dump(data, outfile, indent = 4)
    c = qemuConfig('cve-2017-15649-nokasan.cfg')
    print c.qemu_path
    print c.kernel_path
    print c.append
    print c.ssh_port
    print c.ram_size
    print c.monitor_port
    print c.gdb_port
    print c.hda

    
if __name__=='__main__':
    test()



